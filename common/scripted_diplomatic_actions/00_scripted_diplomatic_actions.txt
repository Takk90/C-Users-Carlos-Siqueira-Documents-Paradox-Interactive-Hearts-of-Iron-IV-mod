
scripted_diplomatic_actions = {
	##Yard1's Recall Volunteers mod integrated :D
	recall_volunteers = {
		allowed = {
			has_country_flag = allowed_recall_volunteers
			ROOT = { is_ai = no }
		}
		visible = {
			has_country_flag = allowed_recall_volunteers
		}
		selectable = {
			# doing this for nicer tooltips
			if = {
				limit = {
					NOT = { has_volunteers_amount_from = { tag = ROOT count > 0 } }
				}
				custom_trigger_tooltip = {
					tooltip = RECALL_VOLUNTEERS_TOOLTIP
					always = no
				}
			}
			else = {
				custom_trigger_tooltip = {
					tooltip = RECALL_VOLUNTEERS_TOOLTIP_G
					always = yes
				}
			}
		}

		cost = 0
		command_power = 0

		requires_acceptance = no
		show_acceptance_on_action_button = no

		icon = 1

		send_description = RECALL_VOLUNTEERS_SEND_DESC

		complete_effect = {
			ROOT = { recall_volunteers_from = PREV }
		}
	}

	embargo_country = {
		allowed = {
			#ROOT = { is_ai = no }
			always = yes
		}
		visible = {
			THIS = {
				NOT = { has_country_flag = embargo@ROOT }
			}
		}
		selectable = {
			custom_trigger_tooltip = {
				tooltip = EMBARGO_TOOLTIP
				THIS = {
					NOT = { has_country_flag = embargo@ROOT }
				}
			}
			THIS = { NOT = { is_in_faction_with = ROOT } }
			if = {
				limit = {
					ROOT = {
						OR = {
							has_idea = NATO_member
							has_idea = Major_Non_NATO_Ally
						}
					}
				}
				THIS = {
					NOT = {
						has_idea = NATO_member
						has_idea = Major_Non_NATO_Ally
					}
				}
			}

		}
		cost = 150
		command_power = 10
		can_be_sent = {
			always = no
		}
		requires_acceptance = no
		show_acceptance_on_action_button = no
		icon = 1
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action embargo"
			set_country_flag = embargo@ROOT
			add_opinion_modifier = { target = ROOT modifier = embargo }
			reverse_add_opinion_modifier = { target = ROOT modifier = embargo }
			add_opinion_modifier = { target = ROOT modifier = embargo_opinion }
			reverse_add_opinion_modifier = { target = ROOT modifier = embargo_opinion }
			if = {
				limit = {
					ROOT = { tag = USA }
					has_idea = USA_usaid
				}
				THIS = { remove_ideas = USA_usaid }
			}
		}

		send_description = EMBARGO_SEND_DESC

		ai_desire = {
			base = 1
			modifier = {
				ROOT = { has_opinion = { target = PREV value < -50 } }
				add = 100
			}
			modifier = {
				has_war_with = ROOT
				add = 100
			}
			modifier = {
				ROOT = { has_country_flag = embargo@PREV }
				add = 50
			}
			modifier = {
				ROOT = { all_allied_country = { has_war_with = FROM }}
			}
		}
	}

	lift_embargo_country = {
		allowed = {
			always = yes
		}
		visible = {
			THIS = {
				has_country_flag = embargo@ROOT
			}
		}
		selectable = {
			custom_trigger_tooltip = {
				tooltip = LIFT_EMBARGO_TOOLTIP
				THIS = {
					has_country_flag = embargo@ROOT
				}
			}
		}
		cost = 50
		command_power = 0
		can_be_sent = {
			always = no
		}
		requires_acceptance = no
		show_acceptance_on_action_button = no
		icon = 1
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action lift_embargo"
			remove_opinion_modifier = { target = ROOT modifier = embargo }
			remove_opinion_modifier = { target = ROOT modifier = embargo_opinion }
			THIS = {
				country_event = { id = diplo_action_tools.1 }
			}
			add_opinion_modifier = { target = ROOT modifier = recently_embargoed }
			reverse_add_opinion_modifier = { target = ROOT modifier = recently_embargoed }
			clr_country_flag = embargo@ROOT
		}

		send_description = LIFT_EMBARGO_SEND_DESC

		ai_desire = {
			base =  1
			modifier = {
				NOT = { ROOT = { has_opinion = { target = PREV value <-50 } } }
				add = 100
			}
		}
	}

	propose_improved_trade_agreement = {
		allowed = { always = yes }
		visible = { THIS = { NOT = { has_country_flag = trade_agreement@ROOT } } }
		selectable = {
			custom_trigger_tooltip = {
				tooltip = PROPOSE_TRADE_AGREEMENT_TOOLTIP
				THIS = {
					NOT = { has_country_flag = trade_agreement@ROOT }
				}
			}
			THIS = {
				if = {
					limit = { THIS = { is_in_faction = yes } }
					any_allied_country = {
						has_opinion = { target = ROOT value > 0 }
					}
				}
				NOT = { has_war_with = ROOT }
				has_opinion = { target = ROOT value > 0 }
			}
			NOT = {
				any_allied_country = {
					OR = {
						has_war_with = ROOT
						has_opinion = { target = THIS value < -25 }
					}
				}
			}
		}
		cost = 50
		can_be_sent = { always = no }
		requires_acceptance = yes
		show_acceptance_on_action_button = yes
		icon = 1
		send_description = PROPOSE_TRADE_AGREEMENT_DESC

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action propose_improved_trade_agreement"
			set_country_flag = trade_agreement@ROOT
			ROOT = {
				set_country_flag = trade_agreement@PREV
			}
			THIS = {
				add_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				add_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				reverse_add_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				reverse_add_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				generic_grant_1_percent_influence_of_ROOT = yes
				ROOT = {
					generic_grant_1_percent_influence_of_PREV = yes
				}
			}
		}

		accept_title = PROPOSE_TRADE_AGREEMENT_ACCEPT_TT
		accept_description = PROPOSE_TRADE_AGREEMENT_ACCEPT_DESC
		reject_title = PROPOSE_TRADE_AGREEMENT_REJECT_TT
		reject_description = PROPOSE_TRADE_AGREEMENT_REJECT_DESC

		ai_acceptance = {
			base_trade_condition = {
				base = -25
				modifier = {
					add = 1
					is_same_government_THIS_ROOT = yes
				}
				modifier = {
					add = 5
					THIS = { has_opinion = { target = ROOT value > 0 } }
					THIS = { has_opinion = { target = ROOT value < 25 } }
				}
				modifier = {
					add = 10
					THIS = { has_opinion = { target = ROOT value > 24 } }
					THIS = { has_opinion = { target = ROOT value < 50 } }
				}
				modifier = {
					add = 15
					THIS = { has_opinion = { target = ROOT value > 49 } }
					THIS = { has_opinion = { target = ROOT value < 100 } }
				}
				modifier = {
					add = 25
					THIS = { has_opinion = { target = ROOT value > 99 } }
					THIS = { has_opinion = { target = ROOT value < 150 } }
				}
				modifier = {
					add = 30
					THIS = { has_opinion = { target = ROOT value > 149 } }
				}
				modifier = {
					THIS = { tag = ENG }
					add = -25
				}
				modifier = {
					add = -25
					THIS = {
						NOT = {
							OR = {
								has_idea = EU_member
								tag = SWI
							}
						}
						has_government = neutrality
					}
				}
				modifier = {
					THIS = {
						set_temp_variable = { temp_idx = -1 }
						any_of = {
							array = influence_array
							check_variable = { v = ROOT }
						}
						set_temp_variable = { temp_idx = i }
						check_variable = { temp_idx > -1 }
						check_variable = { influence_array_calc^temp_idx > 0.05 }
					}
					add = 2
				}
				modifier = {
					add = 5
					THIS = {
						OR = {
							has_idea = EU_member
							tag = SWI
						}
					}
					ROOT = { has_idea = EU_member }
				}
				modifier = {
					add = -50
					THIS = { has_government = nationalist }
				}
				modifier = {
					ROOT = { has_idea = EU_member }
					THIS = { has_idea = EU_member }
					add = 15
				}
				modifier = {
					ROOT = { has_idea = NATO_member }
					THIS = { has_idea = NATO_member }
					add = 10
				}
				modifier = {
					ROOT = { is_in_faction_with = PREV }
					factor = 2.0
				}
			}
		}

		ai_desire = {
			base = 1
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 0 } }
				add = 5
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 25 } }
				add = 10
			}
			modifier = {
				ROOT = { has_opinion = { target = PREV value > 50 }}
				add = 15
			}
			modifier = {
				ROOT = { is_in_faction_with = PREV }
				factor = 2.0
			}
			modifier = {
				ROOT = { has_idea = EU_member }
				THIS = { has_idea = EU_member }
				factor = 1.5
			}
			modifier = {
				ROOT = { has_idea = NATO_member }
				THIS = { has_idea = NATO_member }
				add = 2
			}
			modifier = {
				OR = {
					AND = {
						ROOT = { tag = CHI }
						THIS = { tag = USA }
					}
					AND = {
						ROOT = { tag = USA }
						THIS = { tag = CHI }
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = KOR }
					}
					AND = {
						ROOT = { tag = KOR }
						THIS = { tag = NKO }
					}
					AND = {
						ROOT = { tag = JAP }
						THIS = { tag = NKO}
					}
					AND = {
						ROOT = { tag = NKO }
						THIS = { tag = JAP }
					}
				}
				factor = 0
			}
			modifier = {
				ROOT = {
					OR = {
						any_enemy_country = {
							is_in_faction_with = PREV.PREV
						}
						any_allied_country = {
							has_war_with = PREV.PREV
						}
					}
				}
				factor = 0
			}
		}
	}

	cancel_trade_agreement = {
		allowed = { always = yes }
		visible = { THIS = { has_country_flag = trade_agreement@ROOT } }
		selectable = {
			custom_trigger_tooltip = {
				tooltip = CANCEL_TRADE_AGREEMENT_TOOLTIP
				THIS = { has_country_flag = trade_agreement@ROOT }
			}
		}
		cost = 100
		can_be_sent = { always = no }
		show_acceptance_on_action_button = no
		requires_acceptance = no
		icon = 1
		send_description = CANCEL_TRADE_AGREEMENT_DESC
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: diplomatic action cancel_trade_agreement"
			THIS = {
				remove_opinion_modifier = { target = ROOT modifier = mutual_trade_agreement }
				remove_opinion_modifier = { target = ROOT modifier = mutual_trade_opinion }
				clr_country_flag = trade_agreement@ROOT
				ROOT = {
					remove_opinion_modifier = { target = PREV modifier = mutual_trade_agreement }
					remove_opinion_modifier = { target = PREV modifier = mutual_trade_opinion }
					add_opinion_modifier = { target = PREV modifier = broke_trade_agreement }
					clr_country_flag = trade_agreement@PREV
				}
				add_opinion_modifier = { target = ROOT modifier = broke_trade_agreement }
			}
		}

		ai_desire = {
			base = 1
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < 0 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -25 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -50 }
				}
				add = 25
			}
			modifier = {
				ROOT = {
					has_opinion = { target = PREV value < -75 }
				}
				add = 100
			}
			modifier = {
				ROOT = {
					any_enemy_country = { is_in_faction_with = PREV.PREV }
				}
				add = 100
			}
			modifier = {
				ROOT = { has_war_with = PREV }
				add = 100
			}
		}
	}
}
