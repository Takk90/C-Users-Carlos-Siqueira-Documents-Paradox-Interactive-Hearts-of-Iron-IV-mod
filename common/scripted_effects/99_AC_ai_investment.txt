# AI Investable Assets Commands
# Used in 00_influence_on_actions.txt :)
# Page 1
# line One - CIC - 1, MIC - 2, NIC - 3
# Line Two - Infrastructure - 4, Offices - 5, SAM - 6, Radar - 7
# Page 2
# Line One - Air Bases - 8, Fuel Silo - 9, Internet Station - 10
# Line Two - Biofuel Refineries - 11
# Positions of Line One: { 8, 45, 82, 119 }, 45
# Positions of Line Two: { 8, 45, 82, 119 }, 76
# In scope STATE random_owned_state
# TAG = { random_owned_state = { } }

# GUI : PREV = { CONTROLLER = { } }
invest_cic = {
	ROOT = {
		set_variable = { project_building_type^-1 = 1 }
		set_variable = { project_build_amount^-1 = 1 }
		update_gui = yes
		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_mic = {
	ROOT = {
		set_variable = { project_building_type^-1 = 2 }
		set_variable = { project_build_amount^-1 = 1 }
		update_gui = yes
		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_nic = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 3 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_infra = {
	ROOT = {
		set_variable = { project_building_type^-1 = 4 }
		set_variable = { project_build_amount^-1 = 1 }
		update_gui = yes
		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_offices = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 5 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_anti_air = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 6 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_radar = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 7 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_air_bases = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 8 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_fuel_silo = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 9 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_internet_station = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 10 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

invest_biofuel_refinery = {
	PREV.PREV = {
		set_variable = { project_building_type^-1 = 11 }
		set_variable = { project_build_amount^-1 = 1 }

		PREV = {
			save_event_target_as = AC_state_event_target
			CONTROLLER = { country_event = { id = AC_event.10 } }
		}
	}
}

# Fired within a target country scope
# TAG_1 = { TAG_2 = { AI_initiate_project = yes } }
# See CHI for example in practice in common/on_actions/99_influence_on_actions.txt
# PREV.PREV is TAG_1
# PREV is TAG_2
# CONTROLLER is TAG_2

# AI_best_score = best score for building
# AI_best_target = best score for state
# AI_best_type = building type that won

AI_initiate_project = {
	log = "AI initiation - [ROOT.GetName] Project to [THIS.GetName] -- [GetDateText]"
	# Temp Scores
	set_temp_variable = { AI_MIN_STATE_SCORE_FOR_PROJECT = 100 }

	# Find state with the BEST score possible
	set_temp_variable = { AI_best_score = -1 }
	# Find state without a project
	set_temp_variable = { AI_best_target = -1 }
	set_temp_variable = { AI_best_type = -1 }

	for_each_scope_loop = {
		array = controlled_states

		if = {
			limit = {
				free_building_slots = { building = infrastructure size < 10 include_locked = no } # not impassable state
				# Fail conditions
				NOT = {
					CONTROLLER = { has_war_with = ROOT } # target state controller at war with project owner
					CONTROLLER = { is_justifying_wargoal_against = ROOT }
					ROOT = { is_justifying_wargoal_against = CONTROLLER }
				}
				NOT = { is_in_array = { array = projects_in_state value = ROOT.id } }
			}
			# Get Industrial Complex Score - Building Type - 1
			AI_get_civilian_industry_score = yes
			# Get Military Industry Score if you have defense industry
			# - Building Type - 2
			if = { limit = { ROOT = { has_idea = defense_industry } }
				AI_get_military_industry_score = yes
			}
			# Get Naval Dockyard Score if you have maritime industry
			# - Building Type - 3
			if = { limit = { ROOT = { has_idea = maritime_industry } THIS = { is_coastal = yes } }
				AI_get_dockyard_score = yes
			}
			# Infrastructure - Building Type - 4
			AI_get_infrastructure_score = yes
			# Offices - Building Type - 5

			# SAM - Building Type - 6
			if = { limit = { ROOT = { has_idea = defense_industry } }

			}
			# Radar - Building Type - 7
			if = { limit = { ROOT = { has_idea = defense_industry } }

			}
			# Air Bases - Building Type - 8
			if = { limit = { ROOT = { has_idea = defense_industry } }

			}
			# Fuel Silo - Building Type - 9

			# Internet Station - Building Type - 10

			# Biofuel Refineries - Building Type - 11
		}
	}

	if = { limit = { NOT = { check_variable = { AI_best_score < AI_MIN_STATE_SCORE_FOR_PROJECT } } }
		var:AI_best_target = {
			ROOT = {
				set_variable = { project_type = -1 }
				set_variable = { project_building_type^-1 = AI_best_type }
				set_variable = { project_build_amount^-1 = 1 }
				update_gui = yes
				PREV = {
					save_event_target_as = AC_state_event_target
					CONTROLLER = { country_event = { id = AC_event.10 } }
				}
			}
		}
		log = "AI Investment Sent [PREV.GetName] to [THIS.GetName]"
	}
	else = {
		log = "AI Investment Failed [PREV.GetName] to [THIS.GetName]"
	}
}

# Building Type 1: Civvie industry
AI_get_civilian_industry_score = {
	if = { limit = { free_building_slots = { building = industrial_complex size > 0  include_locked = no } }
		# Score Modeling
		set_temp_variable = { AI_score = 0 }

		# 20 building level
		set_temp_variable = { v1 = 130 }
		set_temp_variable = { v2 = building_level@industrial_complex }
		multiply_temp_variable = { v2 = 2 } # 40

		subtract_from_temp_variable = { v1 = v2 } # 60 score

		add_to_temp_variable = { AI_score = v1 }

		if = { limit = { check_variable = { AI_score > AI_best_score } }
			set_temp_variable = { AI_best_score = AI_score }
			set_temp_variable = { AI_best_target = THIS.id }
			set_temp_variable = { AI_best_type = 1 }
		}
	}
}

# Building Type 2: Military Industry
AI_get_military_industry_score = {
	set_temp_variable = { AI_score = 0 }

	set_temp_variable = { v1 = 140 }
	set_temp_variable = { v2 = 20 } # Basis
	if = { limit = { CONTROLLER = { has_war = yes } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { has_country_flag = ai_yes_unit_build } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { has_country_flag = AI_is_threatened } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { num_of_military_factories < 15 } }
		add_to_temp_variable = { v2 = 10 }
	}
	if = { limit = { CONTROLLER = { num_of_military_factories < 10 } }
		add_to_temp_variable = { v2 = 10 }
	}
	if = { limit = { CONTROLLER = { num_of_military_factories < 5 } }
		add_to_temp_variable = { v2 = 10 }
	}
	multiply_temp_variable = { v2 = 2 }
	subtract_from_temp_variable = { v1 = v2 }

	add_to_temp_variable = { AI_score = v1 }

	if = { limit = { check_variable = { AI_score > AI_best_score } }
		set_temp_variable = { AI_best_score = AI_score }
		set_temp_variable = { AI_best_target = THIS.id }
		set_temp_variable = { AI_best_type = 2 }
	}
}

# Building Type: 3 Dockyards
AI_get_dockyard_score = {
	set_temp_variable = { AI_score = 0 }

	set_temp_variable = { v1 = 125 }
	set_temp_variable = { v2 = 20 } # Basis
	if = { limit = { CONTROLLER = { has_war = yes } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { has_country_flag = ai_yes_unit_build } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { has_country_flag = AI_is_threatened } }
		add_to_temp_variable = { v2 = 15 }
	}
	if = { limit = { CONTROLLER = { num_of_naval_factories < 15 } }
		add_to_temp_variable = { v2 = 10 }
	}
	if = { limit = { CONTROLLER = { num_of_naval_factories < 10 } }
		add_to_temp_variable = { v2 = 10 }
	}
	if = { limit = { CONTROLLER = { num_of_naval_factories < 5 } }
		add_to_temp_variable = { v2 = 10 }
	}
	multiply_temp_variable = { v2 = 2 }
	subtract_from_temp_variable = { v1 = v2 }

	add_to_temp_variable = { AI_score = v1 }

	if = { limit = { check_variable = { AI_score > AI_best_score } }
		set_temp_variable = { AI_best_score = AI_score }
		set_temp_variable = { AI_best_target = THIS.id }
		set_temp_variable = { AI_best_type = 3 }
	}
}

AI_get_infrastructure_score = {
	if = { limit = { infrastructure < 10 }
		# Score Modeling
		set_temp_variable = { AI_score = 0 }

		set_temp_variable = { v1 = 150 }
		set_temp_variable = { v2 = building_level@infrastructure } #
		multiply_temp_variable = { v2 = 10 }
		subtract_from_temp_variable = { v1 = v2 }
		add_to_temp_variable = { AI_score = v1 }

		if = { limit = { check_variable = { AI_score > AI_best_score } }
			set_temp_variable = { AI_best_score = AI_score }
			set_temp_variable = { AI_best_target = THIS.id }
			set_temp_variable = { AI_best_type = 4 }
		}
	}
	# Ignore if you have 10 infrastructure or if it breaks and you somehow got more
}

AI_get_offices_score = {
	if = {
		limit = {
			free_building_slots = {
				type = industrial_complex
				size > 0
				include_locked = no
			}
		}
		set_temp_variable = { AI_score = 0 }

		set_temp_variable = { v1 = 130 }
		set_temp_variable = { v2 = 10 }
		if = { limit = { CONTROLLER = { num_of_available_civilian_factories < 1 } }
			add_to_temp_variable = { v2 = 15 }
		}
		if = { limit = { CONTROLLER = { num_of_available_civilian_factories < 5 } }
			add_to_temp_variable = { v2 = 12 }
		}
		if = { limit = { CONTROLLER = { num_of_available_civilian_factories < 10 } }
			add_to_temp_variable = { v2 = 8 }
		}
		if = { limit = { CONTROLLER = { num_of_available_civilian_factories < 15 } }
			add_to_temp_variable = { v2 = 5 }
		}

		if = { limit = { CONTROLLER = { check_variable = { gdp_per_capita < 9.999 } } }
			add_to_temp_variable = { v2 = 5 }
		}
		multiply_temp_variable = { v2 = 10 }
		subtract_from_temp_variable = { v1 = v2 }
		add_to_temp_variable = { AI_score = v1 }

		if = { limit = { check_variable = { AI_score > AI_best_score } }
			set_temp_variable = { AI_best_score = AI_score }
			set_temp_variable = { AI_best_target = THIS.id }
			set_temp_variable = { AI_best_type = 4 }
		}
	}
}